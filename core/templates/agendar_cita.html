{% load static %}

<form method="POST">
  {% csrf_token %}
  <h2>Agendar Cita Médica</h2>

  <label for="especialidad">Especialidad:</label>
  <select name="especialidad" id="especialidad" required>
    <option value="medicina_general"></option>
    <option value="medicina_general">Medicina General</option>
    <option value="odontologia">Odontología</option>
    <option value="pediatria">Pediatría</option>
    <option value="dermatologia">Dermatología</option>
    <option value="ginecologia">Ginecología</option>
    <option value="psicologia">Psicología</option>
  </select>

  <label for="doctor">Doctor:</label>
  <select name="doctor" id="doctor" required>
    <!-- Se llenará con los doctores correspondientes a la especialidad seleccionada -->
  </select>

  <label for="fecha">Fecha:</label>
  <input type="date" name="fecha" required />

  <label for="hora">Hora:</label>
  <input type="time" name="hora" required />

  <button type="submit">Agendar</button>
</form>

<script>
  document.getElementById('especialidad').addEventListener('change', function() {
    const especialidad = this.value;

    fetch(/doctores/?especialidad=${especialidad})
      .then(response => response.json())
      .then(data => {
        const doctorSelect = document.getElementById('doctor');
        doctorSelect.innerHTML = '';  // Limpiar opciones previas

        // Agregar una opción predeterminada
        const defaultOption = document.createElement('option');
        defaultOption.text = 'Seleccione un doctor';
        doctorSelect.add(defaultOption);

        // Agregar las opciones de doctores disponibles
        data.forEach(doctor => {
          const option = document.createElement('option');
          option.value = doctor.id;
          option.text = doctor.nombre;
          doctorSelect.add(option);
        });
      });
  });
</script>